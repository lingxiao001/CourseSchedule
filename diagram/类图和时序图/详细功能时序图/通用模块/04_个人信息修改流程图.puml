@startuml 个人信息修改流程图
title 个人信息修改流程图

start

:用户访问个人信息页面;
:验证JWT令牌;

if (令牌验证通过?) then (是)
    :获取用户基本信息;
    
    if (用户角色为学生?) then (是)
        :获取学生详细信息;
    elseif (用户角色为教师?) then (是)
        :获取教师详细信息;
    endif
    
    :组装用户完整信息;
    :显示当前个人信息;
    :用户修改个人信息;
    :前端表单验证;
    
    if (表单验证通过?) then (是)
        :发送修改请求;
        :服务端参数验证;
        
        if (参数验证通过?) then (是)
            :业务规则验证;
            
            if (业务验证通过?) then (是)
                :检查邮箱唯一性;
                
                if (邮箱可用或未修改?) then (是)
                    :开始数据库事务;
                    :更新用户基本信息;
                    
                    if (修改了学生信息?) then (是)
                        :更新学生详细信息;
                    elseif (修改了教师信息?) then (是)
                        :更新教师详细信息;
                    endif
                    
                    :提交事务;
                    :记录修改日志;
                    :显示修改成功提示;
                    :刷新页面显示新信息;
                else (否)
                    :显示邮箱冲突错误;
                endif
            else (否)
                :显示业务验证错误;
            endif
        else (否)
            :显示参数错误;
        endif
    else (否)
        :显示表单验证错误;
    endif
else (否)
    :重定向到登录页面;
    stop
endif

stop

@enduml 